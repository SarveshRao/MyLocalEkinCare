= content_for :title, 'Medications'

%div.clearfix.breadcrumb
  %ol.padder
    = render_breadcrumbs :separator => ' / '
    %small.pull-right
      Contact: 888-678-EKIN (3546) /
      %a{href: 'mailto:founder@ekincare.com'} founder@ekincare.com

%div{style: 'min-height: 1000px'}
  %section.vbox
    %section.scrollable.bg-white
      .wrapper-lg.bg-light
        = render partial: 'layouts/customer/profile_avatar'
  .row.padder-v
    .col-lg-12.col-md-12.col-xs-12
      .text-left#customer_medications_panel
        .vbox
          %h4.panel-heading
            %a.font-bold{href: "#"}
              Medications &nbsp;&nbsp;
          - if !session['is_doctor']
            %a.btn.btn-default.btn-s-mdsche.m-b-xs#create_customer_medication{href: '#'}
              &nbsp;
              %i.fa.fa-plus
              &nbsp;Add new &nbsp;&nbsp;
          .scrollable
            %section.panel.panel-default
              .table-responsive
                %table.table.table-striped.b-light#medications_table
                  %thead
                    %tr#medication_table_header{class: "#{@medications.empty? ? 'hide' : ''}"}
                      %th.th-sortable{"data-toggle" => "class", width: '15%'}
                        Name
                        -#%span.th-sort
                          %i.fa.fa-sort-down.text
                          %i.fa.fa-sort-up.text-active
                          %i.fa.fa-sort
                      %th{width: '10%'} Type
                      %th{width: '15%'}  Date
                      -#%th{width: '9%'}  Instructions
                      %th{width: '10%'}  Dose Qty
                      %th{width: '12%'}  Rate Qty
                      %th{width: '18%'}  Prescriber
                      %th{width: '10%'}  Active
                      %th{colspan: 2, width: '10%'}

                  %tbody
                    = form_for Medication.new, url: customers_medications_path, html: {id: 'new_customer_medication'}, remote: true do |f|
                      %tr#customer_medication_new_form.hide
                        %td
                          = f.text_field :name, {placeholder: 'Name', class: 'form-control'}
                        %td
                          = f.select :medication_type,['Liquid','Tablet'],{}, {class: 'form-control', placeholder: 'Type'}
                        %td
                          = f.text_field :date, {placeholder: 'dd-mm-yyyy', class: 'form-control datepicker-input datepicker', 'data-date-format' => 'dd-mm-yyyy'}
                        -#%td
                          = f.text_area :instructions, {placeholder: 'Instructions', class: 'form-control'}
                        %td
                          = f.text_field :dose_quantity, {placeholder: 'Dose quantity', class: 'form-control'}
                        %td
                          = f.text_field :rate_quantity, {placeholder: 'Rate quantity', class: 'form-control'}
                        %td
                          = f.text_field :prescriber_name, {placeholder: 'Prescriber name', class: 'form-control'}
                        %td
                          = f.select :active, [['select',''], ['yes','true'],['no','false']],{}, {class: 'form-control'}
                        %td
                          = f.submit 'save', {id: 'customer_medication_save_btn',class:'btn btn-sm small-btn btn-primary'}
                        %td
                          %a{id: 'customer_medication_cancel_btn', class: 'btn btn-sm small-btn btn-danger'} cancel
                          %input{type: 'reset', class: 'hide', id: 'reset_customer_medication_btn'}

                    - if !@medications.empty?
                      - @medications.each do |medication|
                        %tr.medication-row
                          %td
                            = medication.name
                          %td
                            = medication.medication_type
                          %td
                            = formatted_date medication.date
                          -#%td
                            = medication.instructions
                          %td
                            = medication.dose_quantity
                          %td
                            = medication.rate_quantity
                          %td
                            = medication.prescriber_name
                          %td
                            -if medication.active
                              %a.active{href: "#"}
                                %i.fa.fa-check.text-success.text-active
                                %i.fa.fa-times.text-danger.text
                            -else
                              %a{href: "#"}
                                %i.fa.fa-check.text-success.text-active
                                %i.fa.fa-times.text-danger.text
                          -if !session[:is_doctor]
                            %td
                              %a.pull-right.dropdown-toggle.customer-medication-edit-pencil{"data-toggle" => "dropdown", href: "#"}
                                %i.fa.fa-pencil
                          -if !session[:is_doctor]
                            %td
                              %a.pull-right.dropdown-toggle.customer-medication-delete-row{"data-toggle" => "dropdown", href: "#"}
                                %i.i.i-trashcan

                        = form_for medication, url:  customers_medication_path(medication), html: {class: 'edit-customer-medication'}, remote: true do |f|
                          %tr.edit_medication_row.hide{customer_id: @customer.id, medication_id: medication.id}
                            %td
                              = f.text_field :name, {placeholder: 'Name', class: 'form-control'}
                            %td
                              = f.select :medication_type,['Liquid','Tablet'],{}, {placeholder: 'Type', class: 'form-control'}
                            %td
                              = f.text_field :date, {value: numeric_date_format(medication.date), placeholder: 'dd-mm-yyyy', class: 'form-control datepicker-input datepicker', 'data-date-format' => 'dd-mm-yyyy'}
                            -#%td
                              = f.text_area :instructions, {placeholder: 'Instructions', class: 'form-control'}
                            %td
                              = f.text_field :dose_quantity, {placeholder: 'Dose quantity', class: 'form-control'}
                            %td
                              = f.text_field :rate_quantity, {placeholder: 'Rate quantity', class: 'form-control'}
                            %td
                              = f.text_field :prescriber_name, {placeholder: 'Prescriber name', class: 'form-control'}
                            %td
                              = f.select :active, [['yes','true'],['no','false']],{}, {class: 'form-control'}
                            %td
                              = f.submit 'save', {class:'btn btn-sm small-btn btn-primary customer-medication-save-btn'}
                            %td
                              %a{class: 'btn btn-sm small-btn btn-danger customer-medication-cancel-btn'} cancel
                              %input{type: 'reset', class: 'hide reset-medication-row-btn'}
                    - else
                      %tr#no_medications_row
                        %td{colspan: 9}
                          .text-center
                            %p Please update your medicines information. Just take a picture of your precription and we will digitilize it for you.
                            %p
                              = link_to "click here", "http://youtu.be/0Z67UT6Er9Q", style: 'color: #279fbb'
                              for a step-by-step procedure.
